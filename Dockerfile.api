FROM oven/bun:1-alpine AS base
WORKDIR /app

FROM base AS deps
COPY package.json ./
RUN bun install --production --ignore-scripts

FROM base AS runner
COPY --from=deps /app/node_modules ./node_modules
COPY tsconfig.json ./
COPY server/ ./server/
COPY lib/ ./lib/
COPY drizzle/ ./drizzle/

EXPOSE 3001
CMD ["bun", "server/index.ts"]
